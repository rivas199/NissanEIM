<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Integración EIM + Tickets Jira</title>
</head>
<body>
  <h1>Integración EIM (GPAS) + Tickets por día (Jira)</h1>

  <!-- Sección para mostrar datos de la API EIM (lo que ya existía) -->
  <div>
    <h2>Datos de EIM (GPAS)</h2>
    <pre id="eim-result">Cargando...</pre>
  </div>

  <!-- Sección para mostrar los tickets por día de Jira -->
  <div>
    <h2>Tickets por día (P1, P2, P3)</h2>
    <div id="jira-tickets">Cargando...</div>
  </div>

  <script>
  /********************************************************************
   * 1) CÓDIGO ANTERIOR PARA EIM (GPAS) - NO TOCAR
   ********************************************************************/
  // Tal cual tenías (ejemplo ficticio). 
  // Pega aquí tu fetch o lo que uses para conectar con EIM:
  (async function fetchEIM() {
    try {
      // Ejemplo: Supongamos que tu Netlify Function se llama "eimApi"
      // y hace la lógica para el EIM. Respeto tus parámetros y método.
      const response = await fetch('/.netlify/functions/eimApi', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          // Parámetros o datos que envías a EIM...
          query: 'algo',
          otherParam: 'valor'
        })
      });
      
      if (!response.ok) {
        throw new Error('Error al obtener datos de EIM');
      }

      const data = await response.json();
      // Mostrar en la página
      document.getElementById('eim-result').textContent = JSON.stringify(data, null, 2);
    } catch (error) {
      document.getElementById('eim-result').textContent = 'Error: ' + error.message;
      console.error(error);
    }
  })();

  /********************************************************************
   * 2) NUEVA LÓGICA PARA TICKETS POR DÍA (Jira)
   ********************************************************************/
  (async function fetchJiraTicketsByDay() {
    // Ajusta el rango de fechas (ejemplo)
    const START_DATE = '2025-02-01';
    const END_DATE   = '2025-02-07';
    const url = `/.netlify/functions/ticketsByday?start=${START_DATE}&end=${END_DATE}`;

    try {
      const res = await fetch(url);
      if (!res.ok) {
        throw new Error('Error en la llamada a ticketsByday');
      }
      // En nuestro ejemplo, la función ticketsByday devuelve algo como:
      // {
      //   gpasData: {...},     // si es que lo integraste ahí
      //   dailyCounts: {
      //     "2025-02-01": { p1: x, p2: y, p3: z },
      //     ...
      //   }
      // }
      const data = await res.json();
      
      // data.dailyCounts es el objeto con fechas -> {p1, p2, p3}
      const dailyCounts = data.dailyCounts || {};

      // Generar una tabla HTML
      let html = '<table border="1" cellpadding="5" cellspacing="0">';
      html += '<tr><th>Fecha</th><th>P1</th><th>P2</th><th>P3</th></tr>';

      for (const [date, counts] of Object.entries(dailyCounts)) {
        html += `<tr>
          <td>${date}</td>
          <td>${counts.p1}</td>
          <td>${counts.p2}</td>
          <td>${counts.p3}</td>
        </tr>`;
      }

      html += '</table>';
      document.getElementById('jira-tickets').innerHTML = html;
    } catch (error) {
      document.getElementById('jira-tickets').textContent = 'Error: ' + error.message;
      console.error(error);
    }
  })();
  </script>
</body>
</html>
